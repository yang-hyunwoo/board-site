"use strict";(self["webpackChunkboard_site_front"]=self["webpackChunkboard_site_front"]||[]).push([[242],{3242:function(t,a,e){e.r(a),e.d(a,{default:function(){return z}});var i=e(3396),s=e(7139),l=e(9242);const n=t=>((0,i.dD)("data-v-28ce736e"),t=t(),(0,i.Cn)(),t),o={class:"py-4 text-center"},r=["src"],c={class:"row g-5 juscustom"},_={class:"col-md-7 col-lg-8",style:{"margin-left":"0.5rem"}},h={class:"row g-3"},u={class:"col-11"},p=n((()=>(0,i._)("label",{for:"email",class:"form-label"},"이름 ",-1))),d={class:"col-11"},m=n((()=>(0,i._)("label",{for:"email",class:"form-label"},"Email",-1))),y={class:"col-11"},v=(0,i.Uk)(" 인원 : "),g=n((()=>(0,i._)("hr",{class:"my-4"},null,-1))),f={class:"form-check"},w=n((()=>(0,i._)("hr",{class:"my-4"},null,-1))),k={class:"form-check"},b=n((()=>(0,i._)("label",{class:"form-check-label",for:"save-info"},"결제에 동의",-1))),$=n((()=>(0,i._)("br",null,null,-1)));function x(t,a,e,n,x,C){const U=(0,i.up)("BlackBg");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",o,[t.img_chk?((0,i.wg)(),(0,i.iD)("img",{key:0,src:t.img,width:"200",height:"200"},null,8,r)):(0,i.kq)("",!0),(0,i._)("h2",null,(0,s.zw)(t.travel_name),1)]),(0,i._)("div",null,[(0,i._)("div",c,[(0,i._)("div",_,[(0,i._)("div",h,[(0,i._)("div",u,[p,(0,i.wy)((0,i._)("input",{type:"email","onUpdate:modelValue":a[0]||(a[0]=a=>t.user_name=a),class:"form-control",placeholder:"홍길동"},null,512),[[l.nr,t.user_name]])]),(0,i._)("div",d,[m,(0,i.wy)((0,i._)("input",{type:"email","onUpdate:modelValue":a[1]||(a[1]=a=>t.email=a),class:"form-control",id:"email",placeholder:"you@example.com"},null,512),[[l.nr,t.email]])]),(0,i._)("div",y,[v,(0,i._)("button",{onClick:a[2]||(a[2]=(...t)=>C.minus&&C.minus(...t)),class:"btn-cl",style:{"font-size":"20px"}},"-"),(0,i.wy)((0,i._)("input",{type:"number",name:"amount","onUpdate:modelValue":a[3]||(a[3]=a=>t.total_count=a),style:{width:"8%"}},null,512),[[l.nr,t.total_count]]),(0,i._)("button",{class:"btn-cl",style:{"font-size":"20px"},onClick:a[4]||(a[4]=(...t)=>C.plus&&C.plus(...t))},"+")])]),g,(0,i._)("div",f," 주문 금액 :"+(0,s.zw)(t.$numberWithCommas(t.init_sale_pay))+"원 ",1),w,(0,i._)("div",k,[(0,i.wy)((0,i._)("input",{type:"checkbox",class:"form-check-input",id:"save-info","onUpdate:modelValue":a[5]||(a[5]=a=>t.pay_chk=a)},null,512),[[l.e8,t.pay_chk]]),b]),$,(0,i._)("button",{class:"w-100 btn btn-primary btn-lg",onClick:a[6]||(a[6]=(...t)=>C.iamport&&C.iamport(...t))},"결제하기")])])]),t.loading?((0,i.wg)(),(0,i.j4)(U,{key:0})):(0,i.kq)("",!0)],64)}var C={data:function(){return{user_name:"",email:"",total_count:1,travel_name:"",travel_list_id:this.$route.query.sn,travel_id:"",real_pay:0,sale_pay:0,init_sale_pay:0,pay_chk:!1,loading:!1,person_count:0,person_max_count:0,img_chk:!1}},created(){null!=this.travel_list_id&&void 0!=this.travel_list_id&&"null"!=this.travel_list_id&&"undefined"!=this.travel_list_id||history.back(-1),this.init()},methods:{init(){this.traveDetail()},traveDetail(){this.$axios.get("/api/trip/agency-trip/"+this.travel_list_id).then((t=>{if("SUCCESS"==t.data.resultCode){let a=t.data.result;this.travel_name=a.title,this.real_pay=a.real_paid,this.sale_pay=a.sale_paid,this.init_sale_pay=a.sale_paid,this.travel_id=a.travel_agency_id,this.person_max_count=a.person_max_count,null==a.filePath?this.img_chk=!1:(this.img_chk=!0,this.img=a.filePath)}})).catch((t=>{console.log(t.response.data.result),this.$swal("",t.response.data.result,"error"),this.$router.push("/travelList")})).finally((()=>{}))},iamport(){if(this.pay_chk){this.$axios.get("/api/trip/agency-trip/"+this.travel_list_id).then((t=>{if("SUCCESS"==t.data.resultCode){let a=t.data.result;this.person_count=a.person_count}})).catch((()=>{this.$swal("","잠시후 다시 이용해주세요.","error")})).finally((()=>{}));let a={operland:"plus",count:this.total_count};if(console.log(this.person_count),console.log(this.total_count),console.log(this.person_max_count),this.person_count+this.total_count<=this.person_max_count){this.$axios.get("/api/trip/agency-trip/count/"+this.travel_list_id,{params:a}).then((()=>{})).catch((()=>{this.$swal("","잠시후 다시 이용해주세요.","error")})).finally((()=>{}));var t=window.IMP;t.init("imp42765074"),t.request_pay({pg:"html5_inicis",pay_method:"card",name:this.travel_name,amount:this.init_sale_pay,buyer_email:this.email,buyer_name:this.user_name},(t=>{if(t.success){const a={Authorization:"Bearer "+sessionStorage.getItem("token")};let e={travelAgencyId:this.travel_id,travelAgencyListId:this.travel_list_id,merchantUid:t.merchant_uid,impUid:t.imp_uid,payEmail:this.email,payName:this.user_name,paid:t.paid_amount,personCount:this.total_count};this.loading=!0,this.$axios.post("/api/trip/reser/pay/complete",e,{headers:a}).then((t=>{t.data.result?this.$swal("스크립트 변조","결제 금액이 다릅니다.\n 환불 관련은 관리자에게 문의 하세요.","error"):this.$router.push("/travelPaymentSuccess")})).catch((t=>{this.$swal("",t.response.data.result,"error")})).finally((()=>{this.loading=!1}))}else{let t={operland:"minus",count:this.total_count};this.$axios.get("/api/trip/agency-trip/count/"+this.travel_list_id,{params:t}).then((()=>{})).catch((()=>{this.$swal("","잠시후 다시 이용해주세요.","error")})).finally((()=>{}))}}))}else this.$swal("","마감 되었습니다.","info")}else this.$swal("","결제 동의에 체크 해주세요.","waring")},minus(){this.total_count--},plus(){this.total_count++}},watch:{total_count(){return this.total_count<1?(this.$swal("","1이하로는 입력할수 없습니다.","error"),void(this.total_count=1)):this.total_count>100?(this.$swal("","100이상로는 입력할수 없습니다.","error"),void(this.total_count=1)):void(this.init_sale_pay=this.sale_pay*this.total_count)}}},U=e(89);const S=(0,U.Z)(C,[["render",x],["__scopeId","data-v-28ce736e"]]);var z=S}}]);
//# sourceMappingURL=242.63eeeb11.js.map