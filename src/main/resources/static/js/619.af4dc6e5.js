"use strict";(self["webpackChunkboard_site_front"]=self["webpackChunkboard_site_front"]||[]).push([[619],{5619:function(t,a,i){i.r(a),i.d(a,{default:function(){return I}});var e=i(3396),l=i(7139),s=i(9242);const n=t=>((0,e.dD)("data-v-53bf8f96"),t=t(),(0,e.Cn)(),t),o={class:"py-4 text-center"},r=["src"],c={class:"row g-5 juscustom"},_={class:"col-md-7 col-lg-8",style:{"margin-left":"0.5rem"}},u={class:"row g-3"},h={class:"col-11"},p=n((()=>(0,e._)("label",{for:"email",class:"form-label"},"이름 ",-1))),m={class:"col-11"},d=n((()=>(0,e._)("label",{for:"email",class:"form-label"},"Email",-1))),y={class:"col-11"},v=(0,e.Uk)(" 인원 : "),f=n((()=>(0,e._)("hr",{class:"my-4"},null,-1))),g={class:"form-check"},b=n((()=>(0,e._)("hr",{class:"my-4"},null,-1))),w={class:"form-check"},k=n((()=>(0,e._)("label",{class:"form-check-label",for:"save-info"},"결제에 동의",-1))),$=n((()=>(0,e._)("br",null,null,-1)));function x(t,a,i,n,x,C){const U=(0,e.up)("BlackBg");return(0,e.wg)(),(0,e.iD)(e.HY,null,[(0,e._)("div",o,[t.img_chk?((0,e.wg)(),(0,e.iD)("img",{key:0,src:t.img,width:"200",height:"200"},null,8,r)):(0,e.kq)("",!0),(0,e._)("h2",null,(0,l.zw)(t.travel_name),1)]),(0,e._)("div",null,[(0,e._)("div",c,[(0,e._)("div",_,[(0,e._)("div",u,[(0,e._)("div",h,[p,(0,e.wy)((0,e._)("input",{type:"email","onUpdate:modelValue":a[0]||(a[0]=a=>t.user_name=a),class:"form-control",placeholder:"홍길동"},null,512),[[s.nr,t.user_name]])]),(0,e._)("div",m,[d,(0,e.wy)((0,e._)("input",{type:"email","onUpdate:modelValue":a[1]||(a[1]=a=>t.email=a),class:"form-control",id:"email",placeholder:"you@example.com"},null,512),[[s.nr,t.email]])]),(0,e._)("div",y,[v,(0,e._)("button",{onClick:a[2]||(a[2]=(...t)=>C.minus&&C.minus(...t)),class:"btn-cl",style:{"font-size":"20px"}},"-"),(0,e.wy)((0,e._)("input",{type:"number",name:"amount","onUpdate:modelValue":a[3]||(a[3]=a=>t.total_count=a),style:{width:"8%"}},null,512),[[s.nr,t.total_count]]),(0,e._)("button",{class:"btn-cl",style:{"font-size":"20px"},onClick:a[4]||(a[4]=(...t)=>C.plus&&C.plus(...t))},"+")])]),f,(0,e._)("div",g," 주문 금액 :"+(0,l.zw)(t.$numberWithCommas(t.init_sale_pay))+"원 ",1),b,(0,e._)("div",w,[(0,e.wy)((0,e._)("input",{type:"checkbox",class:"form-check-input",id:"save-info","onUpdate:modelValue":a[5]||(a[5]=a=>t.pay_chk=a)},null,512),[[s.e8,t.pay_chk]]),k]),$,(0,e._)("button",{class:"w-100 btn btn-primary btn-lg",onClick:a[6]||(a[6]=(...t)=>C.iamport&&C.iamport(...t))},"결제하기")])])]),t.loading?((0,e.wg)(),(0,e.j4)(U,{key:0})):(0,e.kq)("",!0)],64)}var C={data:function(){return{user_name:"",email:"",total_count:1,travel_name:"",travel_list_id:this.$route.query.sn,travel_id:"",real_pay:0,sale_pay:0,init_sale_pay:0,pay_chk:!1,loading:!1,person_count:0,person_max_count:0,img_chk:!1}},created(){null!=this.travel_list_id&&void 0!=this.travel_list_id&&"null"!=this.travel_list_id&&"undefined"!=this.travel_list_id||history.back(-1),this.init()},methods:{init(){this.traveDetail()},traveDetail(){this.$axios.get("/api/trip/agency-trip/"+this.travel_list_id).then((t=>{if("SUCCESS"==t.data.resultCode){let a=t.data.result;this.travel_name=a.title,this.real_pay=a.real_paid,this.sale_pay=a.sale_paid,this.init_sale_pay=a.sale_paid,this.travel_id=a.travel_agency_id,this.person_max_count=a.person_max_count,null==a.thumnbnailFileId?this.img_chk=!1:(this.img_chk=!0,this.img="/api/common/image/thumb/"+a.thumnbnailFileId+"/1")}})).catch((t=>{console.log(t.response.data.result),this.$swal("",t.response.data.result,"error"),this.$router.push("/travelList")})).finally((()=>{}))},iamport(){if(this.pay_chk){this.$axios.get("/api/trip/agency-trip/"+this.travel_list_id).then((t=>{if("SUCCESS"==t.data.resultCode){let a=t.data.result;this.person_count=a.person_count}})).catch((()=>{this.$swal("","잠시후 다시 이용해주세요.","error")})).finally((()=>{}));let a={operland:"plus",count:this.total_count};if(console.log(this.person_count),console.log(this.total_count),console.log(this.person_max_count),this.person_count+this.total_count<=this.person_max_count){this.$axios.get("/api/trip/agency-trip/count/"+this.travel_list_id,{params:a}).then((()=>{})).catch((()=>{this.$swal("","잠시후 다시 이용해주세요.","error")})).finally((()=>{}));var t=window.IMP;t.init("imp42765074"),t.request_pay({pg:"html5_inicis",pay_method:"card",name:this.travel_name,amount:this.init_sale_pay,buyer_email:this.email,buyer_name:this.user_name},(t=>{if(t.success){const a={Authorization:"Bearer "+sessionStorage.getItem("token")};let i={travelAgencyId:this.travel_id,travelAgencyListId:this.travel_list_id,merchantUid:t.merchant_uid,impUid:t.imp_uid,payEmail:this.email,payName:this.user_name,paid:t.paid_amount,personCount:this.total_count};this.loading=!0,this.$axios.post("/api/trip/reser/pay/complete",i,{headers:a}).then((t=>{t.data.result?this.$swal("스크립트 변조","결제 금액이 다릅니다.\n 환불 관련은 관리자에게 문의 하세요.","error"):this.$router.push("/travelPaymentSuccess")})).catch((t=>{this.$swal("",t.response.data.result,"error")})).finally((()=>{this.loading=!1}))}else{let t={operland:"minus",count:this.total_count};this.$axios.get("/api/trip/agency-trip/count/"+this.travel_list_id,{params:t}).then((()=>{})).catch((()=>{this.$swal("","잠시후 다시 이용해주세요.","error")})).finally((()=>{}))}}))}else this.$swal("","마감 되었습니다.","info")}else this.$swal("","결제 동의에 체크 해주세요.","waring")},minus(){this.total_count--},plus(){this.total_count++}},watch:{total_count(){return this.total_count<1?(this.$swal("","1이하로는 입력할수 없습니다.","error"),void(this.total_count=1)):this.total_count>100?(this.$swal("","100이상로는 입력할수 없습니다.","error"),void(this.total_count=1)):void(this.init_sale_pay=this.sale_pay*this.total_count)}}},U=i(89);const S=(0,U.Z)(C,[["render",x],["__scopeId","data-v-53bf8f96"]]);var I=S}}]);
//# sourceMappingURL=619.af4dc6e5.js.map