"use strict";(self["webpackChunkboard_site_front"]=self["webpackChunkboard_site_front"]||[]).push([[754],{4068:function(e,s,t){t.r(s),t.d(s,{default:function(){return Z}});var i=t(3396),o=t(7139),a=t(9242);const n=e=>((0,i.dD)("data-v-0bbf200a"),e=e(),(0,i.Cn)(),e),r={class:"container"},l={class:"text-center"},c={class:"jus-cent-mar"},d={class:"messaging"},h={class:"inbox_msg"},m={class:"inbox_people"},_={class:"headind_srch"},g={class:"recent_heading",style:{width:"100%"}},u={style:{"font-size":"15px"}},p={class:"inbox_chat"},k={class:"chat_people"},f={key:0,class:"chat_img"},w=["src"],C={class:"chat_ib"},v={class:"mesgs"},b={class:"msg_history",ref:"messages"},y={key:0,class:"incoming_msg"},I={key:0,class:"incoming_msg_img"},S=["src"],x={class:"received_msg"},$={class:"received_withd_msg"},z={class:"time_date"},B={key:1,class:"outgoing_msg"},L={class:"sent_msg"},A={class:"time_date"},D={class:"type_msg"},E={class:"input_msg_write"},T=n((()=>(0,i._)("i",{class:"fa fa-paper-plane-o","aria-hidden":"true"},null,-1))),U=[T],q={class:"jus-center"};function H(e,s,t,n,T,H){const M=(0,i.up)("BlackBg");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",r,[(0,i._)("h3",l,(0,o.zw)(e.chat_room_name),1),(0,i._)("div",c,[(0,i._)("button",{class:"btn btn-danger",style:{"font-size":"10px"},onClick:s[0]||(s[0]=(...e)=>H.roomExitClick&&H.roomExitClick(...e))},"채팅방 나가기")]),(0,i._)("div",d,[(0,i._)("div",h,[(0,i._)("div",m,[(0,i._)("div",_,[(0,i._)("div",g,[(0,i._)("span",u,"참여 인원: "+(0,o.zw)(e.person_count)+" 명",1)])]),(0,i._)("div",p,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.room_person_list,((e,s)=>((0,i.wg)(),(0,i.iD)("div",{class:"chat_list",key:s},[(0,i._)("div",k,[e.img_real?((0,i.wg)(),(0,i.iD)("div",f,[(0,i._)("img",{src:e.img,alt:"sunil"},null,8,w)])):(0,i.kq)("",!0),(0,i._)("div",C,[(0,i._)("h5",null,(0,o.zw)(e.nickname),1)])])])))),128))])]),(0,i._)("div",v,[(0,i._)("div",b,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.messageList,((e,s)=>((0,i.wg)(),(0,i.iD)("div",{key:s},[e.id_chk?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",y,[e.img_real?((0,i.wg)(),(0,i.iD)("div",I,[(0,i._)("img",{src:e.img,alt:"sunil"},null,8,S)])):(0,i.kq)("",!0),(0,i._)("div",x,[(0,i._)("span",null,(0,o.zw)(e.nick_name),1),(0,i._)("div",$,[(0,i._)("p",null,(0,o.zw)(e.content),1),(0,i._)("span",z,(0,o.zw)(e.created_time)+" | "+(0,o.zw)(e.created_at),1)])])])),e.id_chk?((0,i.wg)(),(0,i.iD)("div",B,[(0,i._)("div",L,[(0,i._)("p",null,(0,o.zw)(e.content),1),(0,i._)("span",A,(0,o.zw)(e.created_time)+" | "+(0,o.zw)(e.created_at),1)])])):(0,i.kq)("",!0)])))),128))],512),(0,i._)("div",D,[(0,i._)("div",E,[(0,i.wy)((0,i._)("input",{type:"text",class:"write_msg",placeholder:"Type a message","onUpdate:modelValue":s[1]||(s[1]=s=>e.send_message=s),onKeyup:s[2]||(s[2]=(0,a.D2)(((...e)=>H.send_message_click&&H.send_message_click(...e)),["enter"]))},null,544),[[a.nr,e.send_message]]),(0,i._)("button",{class:"msg_send_btn",type:"button",onClick:s[3]||(s[3]=(...e)=>H.send_message_click&&H.send_message_click(...e))},U)])])])])])]),(0,i._)("div",q,[(0,i._)("button",{class:"btn btn-primary",onClick:s[4]||(s[4]=(...e)=>H.chatListClick&&H.chatListClick(...e))},"목록으로 이동")]),e.loading?((0,i.wg)(),(0,i.j4)(M,{key:0})):(0,i.kq)("",!0)],64)}var M=t(3266),N=t.n(M),j=t(4029),K=t.n(j),P=t(5033),Y={data:function(){return{messageList:[],stompClient:"",room_id:this.$route.query.sn,loading:!1,send_message:"",user_id:"",chat_room_name:"",room_person_list:[],person_count:""}},components:{BlackBg:P.Z},created(){this.init()},methods:{init(){this.userId(),this.roomTitle(),this.roomMessage(),this.roomPersonList(),this.connect()},roomTitle(){sessionStorage.getItem("token");this.$axios.get("/api/chat/"+this.room_id).then((e=>{"SUCCESS"==e.data.resultCode&&(this.chat_room_name=e.data.result)})).catch((e=>{this.$swal("",e.response.data.result,"error")})).finally((()=>{}))},userId(){const e={Authorization:"Bearer "+sessionStorage.getItem("token")};this.$axios.get("/api/chat/detail/rooms/chk",{headers:e}).then((e=>{"SUCCESS"==e.data.resultCode&&(""==e.data.result&&void 0==e.data.result&&"undefined"==e.data.result||(this.user_id=e.data.result))})).catch((e=>{this.$swal("",e.response.data.result,"error"),this.$router.push("/")})).finally((()=>{this.loading=!1}))},roomMessage(){const e={Authorization:"Bearer "+sessionStorage.getItem("token")};this.loading=!0,this.$axios.get("/api/chat/detail/rooms/"+this.room_id,{headers:e}).then((e=>{"SUCCESS"==e.data.resultCode&&0!=e.data.result.length&&(this.messageList=[],e.data.result.forEach((e=>{let s=[];null==e.profileId||""==e.profileId?s.img_real=!1:s.img_real=!0,s.img="/api/common/image/"+e.profileId+"/1",s.id_chk=e.idChk,s.nick_name=e.nickName,s.content=e.content,s.created_time=e.createdAt.substr(11,5),s.created_at=e.createdAt.substr(5,2)+"."+e.createdAt.substr(8,2),this.messageList.push(s)})))})).catch((e=>{this.$swal("",e.response.data.result,"error"),this.$router.push("/")})).finally((()=>{this.loading=!1}))},roomPersonList(){const e={Authorization:"Bearer "+sessionStorage.getItem("token")};this.$axios.get("/api/chat/person/"+this.room_id,{headers:e}).then((e=>{"SUCCESS"==e.data.resultCode&&0!=e.data.result.length&&(this.person_count=e.data.result.length,this.room_person_list=[],e.data.result.forEach((e=>{let s=[];s.nickname=e.nickname,s.id=e.tripUserId,null==e.profileId||""==e.profileId?s.img_real=!1:s.img_real=!0,s.img="/api/common/image/"+e.profileId+"/1",this.room_person_list.push(s)})))})).catch((e=>{this.$swal("",e.response.data.result,"error"),this.$router.push("/")})).finally((()=>{this.loading=!1}))},send_message_click(){const e={Authorization:"Bearer "+sessionStorage.getItem("token")},s={chatRoomId:this.room_id,content:this.send_message,TripUserId:this.user_id};this.send_message="",this.stompClient.send("/app/new-Message/"+this.room_id,JSON.stringify(s),e)},connect(){const e={Authorization:"Bearer "+sessionStorage.getItem("token")},s="http://localhost:8081/ws/chat";let t=new(K())(s);this.stompClient=N().over(t),console.log(`소켓 연결을 시도합니다. 서버 주소: ${s}`),this.stompClient.connect(e,(e=>{this.connected=!0,console.log("소켓 연결 성공",e),this.stompClient.subscribe("/topic/new-Message/"+this.room_id,(e=>{let s=JSON.parse(e.body).result,t=[];this.user_id==s.userId?t.id_chk=!0:(t.id_chk=!1,null==s.profileId||""==s.profileId?t.img_real=!1:(t.img_real=!0,t.img="/api/common/image/"+s.profileId+"/1")),t.nick_name=s.nickName,t.content=s.content,t.created_time=s.createdAt.substr(11,5),t.created_at=s.createdAt.substr(5,2)+"."+s.createdAt.substr(8,2),this.messageList.push(t)})),this.stompClient.subscribe("/topic/room-person/"+this.room_id,(e=>{this.roomPersonList()}))}),(e=>{console.log("소켓 연결 실패",e),this.connected=!1}))},chatListClick(){this.$router.push("/chatList")},roomExitClick(){this.$swal.fire({title:"퇴장 하시겠습니까?",text:"다시 되돌릴 수 없습니다.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"확인",cancelButtonText:"취소",reverseButtons:!0}).then((e=>{if(e.isConfirmed){const e={Authorization:"Bearer "+sessionStorage.getItem("token")};this.$axios.delete("/api/chat/person/exit/"+this.room_id,{headers:e}).then((s=>{this.$router.push("/chatList"),this.stompClient.send("/app/roomList",{},e),this.stompClient.send("/app/room-person/"+this.room_id,{},e)})).catch((e=>(this.$swal("",e.response.data.result,"error"),!1))).finally((()=>{}))}}))}},watch:{messages(){this.$nextTick((()=>{let e=this.$refs.messages;e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}))}}},J=t(89);const O=(0,J.Z)(Y,[["render",H],["__scopeId","data-v-0bbf200a"]]);var Z=O}}]);
//# sourceMappingURL=754.556ec0f0.js.map